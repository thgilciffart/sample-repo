#!/bin/sh

echo "
  ███                      █████              ████  ████   ███                                                        
 ░░░                      ░░███              ░░███ ░░███  ░░░                                                         
 ████  ████████    █████  ███████    ██████   ░███  ░███  ████  ████████    ███████    █████ ████  ██████   █████ ████
░░███ ░░███░░███  ███░░  ░░░███░    ░░░░░███  ░███  ░███ ░░███ ░░███░░███  ███░░███   ░░███ ░███  ░░░░░███ ░░███ ░███ 
 ░███  ░███ ░███ ░░█████   ░███      ███████  ░███  ░███  ░███  ░███ ░███ ░███ ░███    ░███ ░███   ███████  ░███ ░███ 
 ░███  ░███ ░███  ░░░░███  ░███ ███ ███░░███  ░███  ░███  ░███  ░███ ░███ ░███ ░███    ░███ ░███  ███░░███  ░███ ░███ 
 █████ ████ █████ ██████   ░░█████ ░░████████ █████ █████ █████ ████ █████░░███████    ░░███████ ░░████████ ░░███████ 
░░░░░ ░░░░ ░░░░░ ░░░░░░     ░░░░░   ░░░░░░░░ ░░░░░ ░░░░░ ░░░░░ ░░░░ ░░░░░  ░░░░░███     ░░░░░███  ░░░░░░░░   ░░░░░███ 
                                                                           ███ ░███     ███ ░███             ███ ░███ 
                                                                          ░░██████     ░░██████             ░░██████  
                                                                           ░░░░░░       ░░░░░░               ░░░░░░   
"
sudo pacman -S --needed git base-devel
git clone https://aur.archlinux.org/yay.git /tmp/yay
(
  cd /tmp/yay
  makepkg -si
)

echo "
  ███                      █████              ████  ████   ███                                                      █████                                         
 ░░░                      ░░███              ░░███ ░░███  ░░░                                                      ░░███                                          
 ████  ████████    █████  ███████    ██████   ░███  ░███  ████  ████████    ███████    ████████   ██████    ██████  ░███ █████  ██████    ███████  ██████   █████ 
░░███ ░░███░░███  ███░░  ░░░███░    ░░░░░███  ░███  ░███ ░░███ ░░███░░███  ███░░███   ░░███░░███ ░░░░░███  ███░░███ ░███░░███  ░░░░░███  ███░░███ ███░░███ ███░░  
 ░███  ░███ ░███ ░░█████   ░███      ███████  ░███  ░███  ░███  ░███ ░███ ░███ ░███    ░███ ░███  ███████ ░███ ░░░  ░██████░    ███████ ░███ ░███░███████ ░░█████ 
 ░███  ░███ ░███  ░░░░███  ░███ ███ ███░░███  ░███  ░███  ░███  ░███ ░███ ░███ ░███    ░███ ░███ ███░░███ ░███  ███ ░███░░███  ███░░███ ░███ ░███░███░░░   ░░░░███
 █████ ████ █████ ██████   ░░█████ ░░████████ █████ █████ █████ ████ █████░░███████    ░███████ ░░████████░░██████  ████ █████░░████████░░███████░░██████  ██████ 
░░░░░ ░░░░ ░░░░░ ░░░░░░     ░░░░░   ░░░░░░░░ ░░░░░ ░░░░░ ░░░░░ ░░░░ ░░░░░  ░░░░░███    ░███░░░   ░░░░░░░░  ░░░░░░  ░░░░ ░░░░░  ░░░░░░░░  ░░░░░███ ░░░░░░  ░░░░░░  
                                                                           ███ ░███    ░███                                              ███ ░███                 
                                                                          ░░██████     █████                                            ░░██████                  
                                                                           ░░░░░░     ░░░░░                                              ░░░░░░                   
"
echo "Installing AUR packages"
yay -S --needed $(<pkg.txt)
echo "Enabling linger for current user"
sudo loginctl enable-linger $USER

echo "
  █████████                                  █████    █████       ███                     
 ███░░░░░███                                ░░███    ░░███       ░░░                      
░███    ░░░  █████ ████ ████████    ██████  ███████   ░███████   ████  ████████    ███████
░░█████████ ░░███ ░███ ░░███░░███  ███░░███░░░███░    ░███░░███ ░░███ ░░███░░███  ███░░███
 ░░░░░░░░███ ░███ ░███  ░███ ░███ ░███ ░░░   ░███     ░███ ░███  ░███  ░███ ░███ ░███ ░███
 ███    ░███ ░███ ░███  ░███ ░███ ░███  ███  ░███ ███ ░███ ░███  ░███  ░███ ░███ ░███ ░███
░░█████████  ░░███████  ████ █████░░██████   ░░█████  ████ █████ █████ ████ █████░░███████
 ░░░░░░░░░    ░░░░░███ ░░░░ ░░░░░  ░░░░░░     ░░░░░  ░░░░ ░░░░░ ░░░░░ ░░░░ ░░░░░  ░░░░░███
              ███ ░███                                                            ███ ░███
             ░░██████                                                            ░░██████ 
              ░░░░░░                                                              ░░░░░░  
"
syncthing generate
sed -i 's/127.0.0.1/0.0.0.0/' $HOME/.local/state/syncthing/config.xml
sudo ufw allow syncthing
sudo ufw allow syncthing-gui
systemctl --user enable --now syncthing.service

echo "
 ███████████            ███  ████                             ████          
░█░░░███░░░█           ░░░  ░░███                            ░░███          
░   ░███  ░   ██████   ████  ░███   █████   ██████   ██████   ░███   ██████ 
    ░███     ░░░░░███ ░░███  ░███  ███░░   ███░░███ ░░░░░███  ░███  ███░░███
    ░███      ███████  ░███  ░███ ░░█████ ░███ ░░░   ███████  ░███ ░███████ 
    ░███     ███░░███  ░███  ░███  ░░░░███░███  ███ ███░░███  ░███ ░███░░░  
    █████   ░░████████ █████ █████ ██████ ░░██████ ░░████████ █████░░██████ 
   ░░░░░     ░░░░░░░░ ░░░░░ ░░░░░ ░░░░░░   ░░░░░░   ░░░░░░░░ ░░░░░  ░░░░░░  
"
sudo systemctl enable --now tailscaled
sudo tailscale set --operator=$USER

echo "
  █████████   █████████  █████   █████
 ███░░░░░███ ███░░░░░███░░███   ░░███ 
░███    ░░░ ░███    ░░░  ░███    ░███ 
░░█████████ ░░█████████  ░███████████ 
 ░░░░░░░░███ ░░░░░░░░███ ░███░░░░░███ 
 ███    ░███ ███    ░███ ░███    ░███ 
░░█████████ ░░█████████  █████   █████
 ░░░░░░░░░   ░░░░░░░░░  ░░░░░   ░░░░░ 
"
sudo ufw allow ssh
cat /tmp/sshd_config <<ssh
Include /etc/ssh/sshd_config.d/*.conf
Port 22

LoginGraceTime 60
PermitRootLogin no
StrictModes yes
MaxAuthTries 6
MaxSessions 10

PubkeyAuthentication yes
UsePAM yes
AuthorizedKeysFile	.ssh/authorized_keys

PasswordAuthentication no
PermitEmptyPasswords no

AllowUsers user
ClientAliveInterval 300
ClientAliveCountMax 2

Subsystem	sftp	/usr/lib/ssh/sftp-server
ssh
sudo cp /tmp/sshd_config /etc/ssh/sshd_config
sudo systemctl enable --now sshd.service

echo "
 ███████████  ███          █████     
░░███░░░░░░█ ░░░          ░░███      
 ░███   █ ░  ████   █████  ░███████  
 ░███████   ░░███  ███░░   ░███░░███ 
 ░███░░░█    ░███ ░░█████  ░███ ░███ 
 ░███  ░     ░███  ░░░░███ ░███ ░███ 
 █████       █████ ██████  ████ █████
░░░░░       ░░░░░ ░░░░░░  ░░░░ ░░░░░ 
"
command -v fish | sudo tee -a /etc/shells
chsh -s "$(command -v fish)"
fish -c '
curl -sL https://raw.githubusercontent.com/jorgebucaran/fisher/main/functions/fisher.fish | source && fisher install jorgebucaran/fisher
fisher install jorgebucaran/nvm.fish
fisher install IlanCosman/tide@v6
fisher install PatrickF1/fzf.fish
nvm install latest
'
echo "                                    ██████   ███          
                                   ███░░███ ░░░           
     ██████   ██████  ████████    ░███ ░░░  ████   ███████
    ███░░███ ███░░███░░███░░███  ███████   ░░███  ███░░███
   ░███ ░░░ ░███ ░███ ░███ ░███ ░░░███░     ░███ ░███ ░███
   ░███  ███░███ ░███ ░███ ░███   ░███      ░███ ░███ ░███
 ██░░██████ ░░██████  ████ █████  █████     █████░░███████
░░  ░░░░░░   ░░░░░░  ░░░░ ░░░░░  ░░░░░     ░░░░░  ░░░░░███
                                                  ███ ░███
                                                 ░░██████ 
                                                  ░░░░░░  
"
cp -r .config $HOME
